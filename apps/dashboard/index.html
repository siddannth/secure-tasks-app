<!doctype html>
<html><head><meta charset="utf-8"/><title>Secure Tasks Dashboard</title><meta name="viewport" content="width=device-width, initial-scale=1"/><style>:root{color-scheme:light dark}body{font-family:system-ui,sans-serif;margin:2rem;max-width:1100px}input,button,select{padding:.5rem;margin:.25rem 0}code{background:rgba(127,127,127,.15);padding:.15rem .35rem;border-radius:6px}.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}.task{border:1px solid #ddd;padding:.5rem .75rem;border-radius:8px;margin:.25rem 0}.col{flex:1;border:1px dashed #ccc;padding:10px;border-radius:8px;min-height:200px}.cols{display:flex;gap:12px}.muted{opacity:.8}.chip{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid #aaa;margin-left:.5rem;font-size:.8rem}</style></head>
<body>
<h1>Secure Tasks Dashboard</h1>
<p class="muted">Use the seeded users to log in and interact with the API.</p>
<ul><li>Owner (Org A): <code>owner@orga.com</code> / <code>owner1234</code></li><li>Admin (Org A): <code>admin@orga.com</code> / <code>admin1234</code></li><li>Viewer (Org B): <code>viewer@orgb.com</code> / <code>viewer1234</code></li></ul>
<h2>Login</h2>
<div class="row"><input id="email" placeholder="email" value="admin@orga.com"/><input id="password" placeholder="password" value="admin1234" type="password"/><button onclick="login()">Login</button><button onclick="logout()">Logout</button></div>
<p>Token: <code id="token"></code></p>
<h2>Tasks</h2>
<div class="row"><select id="statusF"><option value="">All</option><option>todo</option><option>doing</option><option>done</option></select><input id="search" placeholder="search title"/><input id="categoryF" placeholder="category (e.g. Work)"/><button onclick="loadTasks()">Load</button></div>
<div class="row"><input id="newTitle" placeholder="New task title" style="min-width:300px"/><input id="newCategory" placeholder="Category (optional)"/><button onclick="createTask()">+ Create Task</button></div>
<div class="cols"><div class="col"><h3>To Do</h3><div id="todo"></div></div><div class="col"><h3>Doing</h3><div id="doing"></div></div><div class="col"><h3>Done</h3><div id="done"></div></div></div>
<script>
const API='http://localhost:3333';function token(){return localStorage.getItem('jwt')}function headers(){return{'Content-Type':'application/json',...(token()?{Authorization:'Bearer '+token()}: {})}}
async function login(){const email=document.getElementById('email').value;const password=document.getElementById('password').value;const res=await fetch(API+'/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});const data=await res.json();if(data.access_token){localStorage.setItem('jwt',data.access_token);document.getElementById('token').textContent=data.access_token.slice(0,24)+'...';await loadTasks()} else alert('Login failed: '+JSON.stringify(data))}
function logout(){localStorage.removeItem('jwt');document.getElementById('token').textContent='';['todo','doing','done'].forEach(id=>document.getElementById(id).innerHTML='')}
function render(tasks){const cols={todo:document.getElementById('todo'),doing:document.getElementById('doing'),done:document.getElementById('done')};cols.todo.innerHTML=cols.doing.innerHTML=cols.done.innerHTML='';tasks.forEach(t=>{const el=document.createElement('div');el.className='task';el.innerHTML='<strong>'+t.title+'</strong><span class="chip>'+(t.category||'General')+'</span><br><span class="muted">'+new Date(t.createdAt).toLocaleString()+'</span><br><div class="row"><select id="st_'+t.id+'"><option'+(t.status==='todo'?' selected':'')+'>todo</option><option'+(t.status==='doing'?' selected':'')+'>doing</option><option'+(t.status==='done'?' selected':'')+'>done</option></select><button onclick="updateTask(\''+t.id+'\')">Update</button><button onclick="deleteTask(\''+t.id+'\')">Delete</button></div>';cols[t.status].appendChild(el)})}
async function loadTasks(){if(!token())return alert('Login first');const params=new URLSearchParams();const status=document.getElementById('statusF').value;const search=document.getElementById('search').value;const category=document.getElementById('categoryF').value;if(status)params.set('status',status);if(search)params.set('search',search);if(category)params.set('category',category);const res=await fetch(API+'/tasks?'+params.toString(),{headers:headers()});const data=await res.json();render(data)}
async function createTask(){const title=document.getElementById('newTitle').value;const category=document.getElementById('newCategory').value;if(!title)return alert('Enter title');const res=await fetch(API+'/tasks',{method:'POST',headers:headers(),body:JSON.stringify({title,category})});if(res.ok){document.getElementById('newTitle').value='';document.getElementById('newCategory').value='';await loadTasks()} else alert('Create failed')}
async function updateTask(id){const st=document.getElementById('st_'+id).value;const res=await fetch(API+'/tasks/'+id,{method:'PUT',headers:headers(),body:JSON.stringify({status:st})});if(res.ok)await loadTasks();else alert('Update failed')}
async function deleteTask(id){const res=await fetch(API+'/tasks/'+id,{method:'DELETE',headers:headers()});if(res.ok)await loadTasks();else alert('Delete failed')}
</script></body></html>